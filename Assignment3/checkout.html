<!doctype html>
<html lang="en">
<head>
  <meta charset="utf-8" />
  <meta name="viewport" content="width=device-width,initial-scale=1" />
  <title>Checkout - BeCleaner</title>
  <meta name="description" content="Checkout — review your order and complete payment." />

  <!-- Bootstrap CSS (keeps layout & validation visuals) -->
  <link href="https://cdn.jsdelivr.net/npm/bootstrap@5.3.3/dist/css/bootstrap.min.css" rel="stylesheet">

  <!-- Site styles (unchanged) -->
  <link rel="stylesheet" href="styles.css">

  <style>
    /* Small checkout-specific styles (keeps compatibility with existing styles.css) */
    .checkout-wrapper{padding:28px 0 60px;min-height:100vh}
    .checkout-container{max-width:1100px;margin:0 auto}
    .checkout-btn{width:100%;padding:12px;border-radius:10px;font-weight:800}
    /* Ensure .invalid-feedback displays when inserted by jQuery Validate */
    .invalid-feedback { display: block; }
  </style>
</head>
<body>
  <header class="site-header">
    <div class="container header-inner">
      <a class="brand" href="index.html"><span class="be">Be</span><span class="cleaner">cleaner</span></a>
      <nav class="header-nav" aria-label="Top">
        <a href="index.html">Home</a>
        <a href="contact.html">Contact</a>
      </nav>
    </div>
  </header>

  <main class="checkout-wrapper">
    <div class="container checkout-container">
      <div class="progress-title">Checkout</div>
      <div class="small-muted mb-3">Complete the form to place your order.</div>

      <div class="row g-4">
        <!-- left: form -->
        <div class="col-12 col-lg-7">
          <div class="card-muted">
            <h4>Customer & Shipping</h4>
            <form id="checkout-form" novalidate>
              <div class="mb-3">
                <label for="serviceSelect" class="form-label">Select service</label>
                <select id="serviceSelect" name="serviceSelect" class="form-select" required>
                  <option value="" data-price="0">Choose...</option>
                  <option value="Standard Home Cleaning" data-price="49">Standard Home Cleaning — $49</option>
                  <option value="Deep Cleaning" data-price="99">Deep Cleaning — $99</option>
                  <option value="Office Cleaning" data-price="79">Office Cleaning — $79</option>
                </select>
                <!-- placeholder for bootstrap invalid-feedback if needed -->
                <div class="invalid-feedback">Please select a service.</div>
              </div>

              <div class="row g-3">
                <div class="col-12">
                  <label for="fullName" class="form-label">Full name</label>
                  <input id="fullName" name="fullName" class="form-control" type="text" placeholder="Jane Doe" required>
                </div>
                <div class="col-md-6">
                  <label for="email" class="form-label">Email</label>
                  <input id="email" name="email" class="form-control" type="email" placeholder="you@example.com" required>
                </div>
                <div class="col-md-6">
                  <label for="phone" class="form-label">Phone</label>
                  <input id="phone" name="phone" class="form-control" type="tel" placeholder="+1 (555) 555-5555" required>
                </div>
                <div class="col-12">
                  <label for="address" class="form-label">Address</label>
                  <input id="address" name="address" class="form-control" type="text" placeholder="123 Main St" required>
                </div>
                <div class="col-md-4">
                  <label for="city" class="form-label">City</label>
                  <input id="city" name="city" class="form-control" type="text" required>
                </div>
                <div class="col-md-4">
                  <label for="postal" class="form-label">Postal code</label>
                  <input id="postal" name="postal" class="form-control" type="text" required>
                </div>
                <div class="col-md-4">
                  <label for="country" class="form-label">Country</label>
                  <select id="country" name="country" class="form-select" required>
                    <option value="">Choose...</option>
                    <option>United States</option>
                    <option>Canada</option>
                    <option>United Kingdom</option>
                    <option>Australia</option>
                  </select>
                </div>
                <div class="col-12">
                  <div class="form-check">
                    <input id="billingSame" name="billingSame" class="form-check-input" type="checkbox" checked>
                    <label for="billingSame" class="form-check-label">Billing same as shipping</label>
                  </div>
                </div>
              </div>

              <hr class="my-3" />
              <h5>Add-ons</h5>
              <div class="mb-2 service-checkbox">
                <input id="addonWindow" class="form-check-input me-2 addon" type="checkbox" data-price="15">
                <label for="addonWindow" class="form-check-label">Window add-on — $15</label>
              </div>
              <div class="mb-2 service-checkbox">
                <input id="addonFridge" class="form-check-input me-2 addon" type="checkbox" data-price="25">
                <label for="addonFridge" class="form-check-label">Fridge interior — $25</label>
              </div>

              <div class="row g-3 mt-2">
                <div class="col-md-6">
                  <label for="date" class="form-label">Preferred date</label>
                  <input id="date" name="date" class="form-control" type="date" required>
                </div>
                <div class="col-md-6">
                  <label for="time" class="form-label">Preferred time</label>
                  <input id="time" name="time" class="form-control" type="time" required>
                </div>
              </div>

              <hr class="my-3" />
              <h5>Payment</h5>
              <fieldset class="mb-3">
                <div class="form-check">
                  <input id="pay-card" name="paymentMethod" class="form-check-input" type="radio" value="card" checked>
                  <label for="pay-card" class="form-check-label">Card</label>
                </div>
                <div class="form-check">
                  <input id="pay-cod" name="paymentMethod" class="form-check-input" type="radio" value="cod">
                  <label for="pay-cod" class="form-check-label">Cash on Delivery (COD)</label>
                </div>
                <div class="form-check">
                  <input id="pay-wallet" name="paymentMethod" class="form-check-input" type="radio" value="wallet">
                  <label for="pay-wallet" class="form-check-label">Wallet</label>
                </div>
              </fieldset>

              <div id="cardFields" class="mb-3">
                <label for="cardNumber" class="form-label">Card number</label>
                <input id="cardNumber" name="cardNumber" class="form-control mb-2" type="text" placeholder="1234 5678 9012 3456" maxlength="19" pattern="[0-9\s]{13,19}">
                <div class="row g-3">
                  <div class="col-6">
                    <label for="expiry" class="form-label">Expiry (MM/YY)</label>
                    <input id="expiry" name="expiry" class="form-control" type="text" placeholder="08/26" maxlength="5" pattern="(0[1-9]|1[0-2])\/\d{2}">
                  </div>
                  <div class="col-6">
                    <label for="cvv" class="form-label">CVV</label>
                    <input id="cvv" name="cvv" class="form-control" type="password" maxlength="4" pattern="\d{3,4}" placeholder="123">
                  </div>
                </div>
              </div>

              <hr class="my-3" />
              <div class="mb-3 form-check">
                <input id="agreeTerms" name="agreeTerms" class="form-check-input" type="checkbox">
                <label for="agreeTerms" class="form-check-label">I agree to the <a href="/terms.html">terms and conditions</a>.</label>
              </div>

              <div class="d-grid">
                <button id="placeOrderBtn" class="checkout-btn" type="button" disabled>Place Order</button>
              </div>
            </form>
          </div>
        </div>

        <!-- right: order summary -->
        <aside class="col-12 col-lg-5">
          <div class="order-summary" aria-live="polite">
            <h3>Order summary</h3>
            <div id="itemsList" class="order-items"><div class="small-muted">No items selected</div></div>

            <div class="totals mt-3">
              <div class="row">
                <div class="col-8 small-muted">Subtotal</div><div class="col-4 text-end" id="subtotal">$0.00</div>
              </div>
              <div class="row">
                <div class="col-8 small-muted">Shipping</div><div class="col-4 text-end" id="shipping">$5.00</div>
              </div>
              <div class="row">
                <div class="col-8 small-muted">Tax</div><div class="col-4 text-end" id="tax">$0.00</div>
              </div>
              <div class="row mt-3 fw-bold">
                <div class="col-8">Grand total</div><div class="col-4 text-end" id="grandTotal">$0.00</div>
              </div>
            </div>

            <div class="mt-3 coupon-row">
              <label for="coupon" class="form-label">Apply coupon</label>
              <div class="d-flex gap-2">
                <input id="coupon" class="form-control form-control-sm" type="text" placeholder="Coupon code">
                <button id="applyCoupon" class="btn btn-outline-secondary btn-sm" type="button">Apply</button>
              </div>
              <div class="form-text small-muted mt-1">(Coupons are non-functional in this demo.)</div>
            </div>
          </div>
        </aside>
      </div>
    </div>
  </main>

  <footer class="py-4 mt-4 border-top">
    <div class="container d-flex justify-content-between flex-wrap">
      <div class="small-muted">© 2025 BeCleaner — All rights reserved.</div>
      <div><a href="/privacy.html" class="small-muted me-3">Privacy</a><a href="/terms.html" class="small-muted">Terms</a></div>
    </div>
  </footer>

  <!-- Libraries: jQuery + jQuery Validate + Bootstrap bundle -->
  <script src="https://code.jquery.com/jquery-3.6.4.min.js"></script>
  <script src="https://cdn.jsdelivr.net/npm/jquery-validation@1.19.5/dist/jquery.validate.min.js"></script>
  <script src="https://cdn.jsdelivr.net/npm/bootstrap@5.3.3/dist/js/bootstrap.bundle.min.js"></script>

  <script>
    /*
      jQuery-based client-side validation added:
      - Uses jQuery Validate to show clear inline error messages before submission
      - Keeps the existing behaviors: dynamic order summary, payment toggle, Place Order enabled by terms checkbox, and redirect to success.html
      - Card fields are validated only when Card payment is selected (conditional rules)
      - Existing UI behaviors preserved (sticky summary, coupon non-functional, etc.)
    */

    (function ($) {
      $(function () {
        // --- Order summary logic (unchanged functionality) ---
        const serviceSelect = $('#serviceSelect');
        const addonEls = $('.addon');
        const itemsList = $('#itemsList');
        const subtotalEl = $('#subtotal');
        const shippingEl = $('#shipping');
        const taxEl = $('#tax');
        const grandEl = $('#grandTotal');
        const SHIPPING = 5.00;
        const TAX_RATE = 0.101; // 10.1%

        function fmt(n){ return '$' + n.toFixed(2); }
        function escapeHtml(t){ return $('<div/>').text(t).html(); }

        function getItems() {
          const out = [];
          const opt = serviceSelect[0].selectedOptions ? serviceSelect[0].selectedOptions[0] : null;
          if (opt && opt.value && Number($(opt).data('price')) > 0) {
            out.push({ name: opt.value, qty: 1, price: Number($(opt).data('price')) });
          }
          addonEls.each(function(){
            const a = $(this);
            if (a.prop('checked')) {
              const label = a.next('label').text().trim() || a.attr('id');
              out.push({ name: label, qty: 1, price: Number(a.data('price') || 0) });
            }
          });
          return out;
        }

        function renderSummary() {
          const items = getItems();
          itemsList.empty();
          if (items.length === 0) {
            itemsList.html('<div class="small-muted">No items selected</div>');
          } else {
            let subtotal = 0;
            items.forEach(it => {
              const line = $('<div class="summary-line"></div>');
              const left = $('<div></div>').append('<div class="fw-semibold">' + escapeHtml(it.name) + '</div>')
                                           .append('<div class="meta small-muted">Qty: ' + it.qty + '</div>');
              const right = $('<div class="fw-semibold"></div>').text(fmt(it.price * it.qty));
              line.append(left).append(right);
              itemsList.append(line);
              subtotal += it.price * it.qty;
            });
            const tax = Math.round(subtotal * TAX_RATE * 100) / 100;
            const grand = Math.round((subtotal + SHIPPING + tax) * 100) / 100;
            subtotalEl.text(fmt(subtotal));
            shippingEl.text(fmt(SHIPPING));
            taxEl.text(fmt(tax));
            grandEl.text(fmt(grand));
          }
        }

        // Bind changes
        serviceSelect.on('change', renderSummary);
        addonEls.on('change', renderSummary);
        $('#date, #time').on('input', renderSummary);
        renderSummary();

        // --- Payment fields toggle (preserve behavior) ---
        const payCard = $('#pay-card'), payCOD = $('#pay-cod'), payWallet = $('#pay-wallet');
        const cardFields = $('#cardFields');
        function updateCardFields() {
          if (payCard.prop('checked')) {
            cardFields.show();
          } else {
            cardFields.hide();
          }
        }
        payCard.add(payCOD).add(payWallet).on('change', updateCardFields);
        updateCardFields();

        // --- Enable place order only when terms checked (preserve behavior) ---
        const agree = $('#agreeTerms');
        const placeBtn = $('#placeOrderBtn');
        function togglePlace() { placeBtn.prop('disabled', !agree.prop('checked')); }
        agree.on('change', togglePlace);
        togglePlace();

        // --- jQuery Validate setup (client-side form validation) ---
        // Custom validators
        $.validator.addMethod('cardNumberValid', function(value, element) {
          if (this.optional(element)) return true;
          const digits = value.replace(/\s+/g, '');
          return /^\d{13,19}$/.test(digits);
        }, 'Please enter a valid card number (13–19 digits).');

        $.validator.addMethod('expiryValid', function(value, element) {
          if (this.optional(element)) return true;
          if (!/^\d{2}\/\d{2}$/.test(value)) return false;
          const parts = value.split('/');
          const month = parseInt(parts[0], 10);
          return month >= 1 && month <= 12;
        }, 'Please use MM/YY format and a valid month.');

        $.validator.addMethod('cvvValid', function(value, element) {
          if (this.optional(element)) return true;
          return /^\d{3,4}$/.test(value);
        }, 'Please enter a valid CVV (3 or 4 digits).');

        // Initialize validator
        const validator = $('#checkout-form').validate({
          // Don't ignore hidden because card fields may be hidden but we validate conditionally via depends
          ignore: [],
          rules: {
            serviceSelect: { required: true },
            fullName: { required: true, minlength: 2 },
            email: { required: true, email: true },
            phone: { required: true, minlength: 6 },
            address: { required: true },
            city: { required: true },
            postal: { required: true },
            country: { required: true },
            date: { required: true },
            time: { required: true },
            cardNumber: {
              required: function() { return $('#pay-card').prop('checked'); },
              cardNumberValid: true
            },
            expiry: {
              required: function() { return $('#pay-card').prop('checked'); },
              expiryValid: true
            },
            cvv: {
              required: function() { return $('#pay-card').prop('checked'); },
              cvvValid: true
            },
            agreeTerms: { required: true }
          },
          messages: {
            serviceSelect: { required: 'Please select a service.' },
            fullName: { required: 'Please enter your full name.', minlength: 'Please enter at least 2 characters.' },
            email: { required: 'Please provide your email.', email: 'Please enter a valid email address.' },
            phone: { required: 'Please provide a phone number.' },
            address: { required: 'Please enter your address.' },
            city: { required: 'Please enter your city.' },
            postal: { required: 'Please enter a postal code.' },
            country: { required: 'Please select your country.' },
            date: { required: 'Please select a preferred date.' },
            time: { required: 'Please select a preferred time.' },
            agreeTerms: { required: 'You must agree to the terms to place an order.' }
          },
          errorElement: 'div',
          errorClass: 'invalid-feedback',
          // Place error messages consistent with Bootstrap markup
          errorPlacement: function(error, element) {
            // For checkbox/radio, place after the control's container
            if (element.is(':checkbox') || element.is(':radio')) {
              error.insertAfter(element.closest('.form-check, fieldset'));
            } else {
              error.insertAfter(element);
            }
          },
          highlight: function(element) {
            $(element).addClass('is-invalid').removeClass('is-valid');
          },
          unhighlight: function(element) {
            $(element).removeClass('is-invalid').addClass('is-valid');
            // remove any existing invalid-feedback for consistency (jQuery Validate handles error elements)
          },
          // When valid and form is submitted, this handler runs
          submitHandler: function(form) {
            // Keep original behavior: simulate placing and then redirect to success.html
            placeBtn.text('Placing...');
            placeBtn.prop('disabled', true);
            setTimeout(function() {
              window.location.href = 'success.html';
            }, 700);
          }
        });

        // Bind Place Order button to trigger validation (we keep button type="button" per existing code)
        placeBtn.on('click', function() {
          // trigger validation
          if ($('#checkout-form').valid()) {
            // validator.submitHandler will handle placing and redirect
            $('#checkout-form').submit();
          } else {
            // scroll to first invalid field for better UX
            const $firstInvalid = $('#checkout-form').find('.is-invalid, :invalid').first();
            if ($firstInvalid && $firstInvalid.length) {
              $firstInvalid.focus();
              $('html,body').animate({ scrollTop: $firstInvalid.offset().top - 100 }, 250);
            }
          }
        });

        // Keep dynamic cardFields visibility in sync with validation (when payment changed, revalidate)
        $('input[name="paymentMethod"]').on('change', function() {
          updateCardFields();
          // re-validate card inputs if they became required / not required
          $('#cardNumber, #expiry, #cvv').each(function() {
            validator.element(this);
          });
        });

        // Also validate on blur for better immediate feedback
        $('#checkout-form input, #checkout-form select').on('blur change input', function() {
          validator.element(this);
        });

        // Preserve coupon apply button (non-functional) behavior: show tiny feedback (no change in totals)
        $('#applyCoupon').on('click', function () {
          // simple placeholder feedback
          $(this).text('Applied').prop('disabled', true);
          setTimeout(() => { $(this).text('Apply').prop('disabled', false); }, 1000);
        });

        // Ensure summary updates when page loads (already called above) and when user types service text changes
        renderSummary();
      });
    })(jQuery);
  </script>
</body>
</html>