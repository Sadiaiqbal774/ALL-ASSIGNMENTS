<!doctype html>
<html lang="en">
<head>
  <meta charset="utf-8" />
  <meta name="viewport" content="width=device-width,initial-scale=1" />
  <title>Manage Bookings — BeCleaner (CRUD demo)</title>
  <meta name="description" content="Single-page CRUD demo for BeCleaner (jQuery + fake REST API)" />

  <!-- Bootstrap 5 for layout and components -->
  <link href="https://cdn.jsdelivr.net/npm/bootstrap@5.3.3/dist/css/bootstrap.min.css" rel="stylesheet">

  <!-- Reuse existing site styles for visual consistency -->
  <link rel="stylesheet" href="styles.css">

  <style>
    /* Page-specific adjustments so the CRUD UI looks tidy and matches your site */
    .crud-wrapper { padding: 28px 0 72px; min-height: 100vh; background: transparent; }
    .crud-card { border-radius: 12px; box-shadow: 0 10px 30px rgba(16,24,40,0.04); background: #fff; padding: 18px; }
    .list-row { display:flex; justify-content:space-between; align-items:center; gap:12px; padding:10px 6px; border-bottom:1px solid rgba(16,24,40,0.04); }
    .list-row .meta { color: #6b7280; font-size: .95rem; margin-top:4px; }
    .muted-small { color: #6b7280; font-size: .92rem; }
    .btn-ghost { background: transparent; border: 1px solid rgba(16,24,40,0.06); }
    .empty-note { padding: 18px; text-align:center; color: #6b7280; }
    .form-inline-row { gap: 8px; display:flex; align-items:center; }
    .crud-grid { display:grid; grid-template-columns: 1fr 420px; gap:24px; }
    @media (max-width: 900px) { .crud-grid { grid-template-columns: 1fr; gap:18px; } }

    /* small helper for inline validation messages */
    .field-error { color: #d04848; font-size: .9rem; margin-top:6px; display:none; }
  </style>
</head>
<body>
  <!-- Header (consistent with your site header) -->
  <header class="site-header">
    <div class="container header-inner">
      <a class="brand" href="index.html"><span class="be">Be</span><span class="cleaner">cleaner</span></a>
      <nav class="header-nav" aria-label="Top">
        <a href="index.html">Home</a>
        <a href="checkout.html">Checkout</a>
      </nav>
    </div>
  </header>

  <main class="crud-wrapper">
    <div class="container">
      <div class="mb-3">
        <h2 class="mb-1">Manage Bookings (Demo CRUD)</h2>
        <div class="muted-small">
          This page demonstrates Create, Read, Update and Delete using jQuery + a free fake REST API (jsonplaceholder.typicode.com).
          Created items are kept in memory for this demo session. No other site files are modified.
        </div>
      </div>

      <div class="crud-grid">
        <!-- LEFT: Form (Create / Update) -->
        <section class="crud-card">
          <h5 id="formTitle">Create booking</h5>

          <form id="crud-form" autocomplete="off" novalidate>
            <input type="hidden" id="editId" value="" />

            <div class="mb-3">
              <label for="service" class="form-label">Service</label>
              <select id="service" name="service" class="form-select" required>
                <option value="">Choose…</option>
                <option value="Standard Home Cleaning">Standard Home Cleaning</option>
                <option value="Deep Cleaning">Deep Cleaning</option>
                <option value="Office Cleaning">Office Cleaning</option>
              </select>
              <div class="field-error" data-for="service">Please pick a service.</div>
            </div>

            <div class="row g-3">
              <div class="col-12">
                <label for="name" class="form-label">Full name</label>
                <input id="name" name="name" class="form-control" type="text" placeholder="Jane Doe" required>
                <div class="field-error" data-for="name">Please enter a name (min 2 chars).</div>
              </div>

              <div class="col-md-6">
                <label for="email" class="form-label">Email</label>
                <input id="email" name="email" type="email" class="form-control" placeholder="you@example.com" required>
                <div class="field-error" data-for="email">Please enter a valid email.</div>
              </div>

              <div class="col-md-6">
                <label for="phone" class="form-label">Phone</label>
                <input id="phone" name="phone" type="tel" class="form-control" placeholder="+1 (555) 555-5555" required>
                <div class="field-error" data-for="phone">Please enter a phone number.</div>
              </div>

              <div class="col-12">
                <label for="address" class="form-label">Address</label>
                <input id="address" name="address" class="form-control" type="text" placeholder="123 Main St" required>
                <div class="field-error" data-for="address">Please enter an address.</div>
              </div>

              <div class="col-md-6">
                <label for="date" class="form-label">Date</label>
                <input id="date" name="date" class="form-control" type="date" required>
                <div class="field-error" data-for="date">Please choose a date.</div>
              </div>

              <div class="col-md-6">
                <label for="time" class="form-label">Time</label>
                <input id="time" name="time" class="form-control" type="time" required>
                <div class="field-error" data-for="time">Please choose a time.</div>
              </div>
            </div>

            <div class="d-flex gap-2 mt-3">
              <button id="saveBtn" class="btn btn-primary" type="button">Save</button>
              <button id="cancelBtn" class="btn btn-outline-secondary" type="button">Cancel</button>
              <div id="formStatus" class="ms-auto muted-small" aria-live="polite"></div>
            </div>
          </form>
        </section>

        <!-- RIGHT: Items list & search -->
        <aside class="crud-card">
          <div class="d-flex align-items-center mb-3">
            <h5 class="mb-0">Bookings</h5>
            <div class="form-inline-row ms-auto">
              <input id="search" class="form-control form-control-sm" placeholder="Search by name or service" />
              <button id="refreshBtn" class="btn btn-ghost btn-sm ms-2">Refresh</button>
            </div>
          </div>

          <div id="listContainer" style="min-height:120px;">
            <div class="empty-note">No bookings yet. Add a booking using the form.</div>
          </div>

          <div class="mt-3 totals muted-small">
            <div>Showing <span id="count">0</span> item(s)</div>
          </div>
        </aside>
      </div>
    </div>
  </main>

  <!-- Footer simple -->
  <footer class="py-4 mt-4 border-top">
    <div class="container d-flex justify-content-between flex-wrap">
      <div class="small-muted">© 2025 BeCleaner — Demo CRUD</div>
      <div><a href="index.html" class="small-muted me-3">Home</a><a href="checkout.html" class="small-muted">Checkout</a></div>
    </div>
  </footer>

  <!-- JS libraries: jQuery + Bootstrap bundle -->
  <script src="https://code.jquery.com/jquery-3.6.4.min.js"></script>
  <script src="https://cdn.jsdelivr.net/npm/bootstrap@5.3.3/dist/js/bootstrap.bundle.min.js"></script>

  <script>
    /*
      Single Page CRUD (jQuery + fake REST API)
      - Uses JSONPlaceholder (https://jsonplaceholder.typicode.com/posts) as a free fake REST API.
      - Keeps a client-side bookings array to render and reflect changes (JSONPlaceholder doesn't persist user data).
      - Does not modify any other site files — index.html, checkout.html and styles.css remain unchanged.
      - Preserves the site's visual style by reusing styles.css.
    */

    (function($){
      'use strict';

      const API_BASE = 'https://jsonplaceholder.typicode.com/posts';

      // Local in-memory array of booking objects shown in the UI
      // Each booking shape: { id, service, name, email, phone, address, date, time }
      let bookings = [];

      // Cached selectors
      const $list = $('#listContainer');
      const $count = $('#count');
      const $form = $('#crud-form');
      const $formStatus = $('#formStatus');
      const $saveBtn = $('#saveBtn');
      const $cancelBtn = $('#cancelBtn');
      const $search = $('#search');
      const $refresh = $('#refreshBtn');

      // Helpers
      function escapeHtml(s){ return $('<div/>').text(s||'').html(); }
      function summaryFor(b){ return (b.service||'') + ' — ' + (b.date||'') + ' ' + (b.time||''); }
      function showStatus(text, type){
        $formStatus.stop(true,true).css('color', type === 'danger' ? '#d04848' : '#0b76ff').text(text).fadeIn(150);
        setTimeout(()=> $formStatus.fadeOut(300, function(){ $formStatus.text('').show(); }), 2200);
      }

      // Render bookings list (client-side)
      function renderList(filterText){
        $list.empty();
        let filtered = bookings.slice();

        if (filterText && filterText.trim()) {
          const q = filterText.toLowerCase();
          filtered = filtered.filter(b =>
            (b.name||'').toLowerCase().includes(q) ||
            (b.service||'').toLowerCase().includes(q)
          );
        }

        if (filtered.length === 0) {
          $list.html('<div class="empty-note">No bookings found.</div>');
        } else {
          const frag = $(document.createDocumentFragment());
          filtered.forEach(b => {
            const $row = $('<div class="list-row"></div>');
            const $left = $('<div></div>');
            $left.append(`<div class="fw-semibold">${escapeHtml(b.name||'—')}</div>`);
            $left.append(`<div class="meta">${escapeHtml(b.service||'—')}</div>`);
            $left.append(`<div class="meta muted-small">${escapeHtml(b.date||'')} ${escapeHtml(b.time||'')}</div>`);

            const $right = $('<div class="d-flex align-items-center"></div>');
            $right.append(`<div class="me-3 muted-small">${escapeHtml(b.email||'')}</div>`);

            const $edit = $(`<button class="btn btn-sm btn-outline-primary me-2" title="Edit">Edit</button>`);
            const $del  = $(`<button class="btn btn-sm btn-outline-danger" title="Delete">Delete</button>`);

            // Edit handler: populate form with booking
            $edit.on('click', function(){
              populateForm(b);
              $('html,body').animate({ scrollTop: 0 }, 200);
            });

            // Delete handler: confirm, call API, remove from local list
            $del.on('click', function(){
              if (!confirm('Delete this booking?')) return;
              $.ajax({
                url: API_BASE + '/' + encodeURIComponent(b.id),
                method: 'DELETE',
                success: function(){
                  bookings = bookings.filter(x => x.id !== b.id);
                  renderList($search.val());
                  showStatus('Booking deleted', 'success');
                },
                error: function(){
                  showStatus('Failed to delete booking (network).', 'danger');
                }
              });
            });

            $right.append($edit).append($del);
            $row.append($left).append($right);
            frag.append($row);
          });
          $list.append(frag);
        }
        $count.text(filtered.length);
      }

      // Populate form for editing
      function populateForm(b){
        $('#editId').val(b.id);
        $('#service').val(b.service);
        $('#name').val(b.name);
        $('#email').val(b.email);
        $('#phone').val(b.phone);
        $('#address').val(b.address);
        $('#date').val(b.date);
        $('#time').val(b.time);
        $('#formTitle').text('Edit booking (id: ' + b.id + ')');
      }

      // Reset form to create mode
      function resetForm(){
        $form[0].reset();
        $('#editId').val('');
        $('#formTitle').text('Create booking');
        $form.find('.is-invalid, .is-valid').removeClass('is-invalid is-valid');
        $('.field-error').hide();
      }

      // Basic front-end validation (keeps original fields required)
      function validateForm(){
        let ok = true;
        // clear first
        $form.find('.is-invalid').removeClass('is-invalid');
        $('.field-error').hide();

        const checks = [
          { id: '#service', test: v => !!v, msgFor: 'service' },
          { id: '#name', test: v => v && v.trim().length >= 2, msgFor: 'name' },
          { id: '#email', test: v => /^\S+@\S+\.\S+$/.test(v || ''), msgFor: 'email' },
          { id: '#phone', test: v => v && v.trim().length >= 6, msgFor: 'phone' },
          { id: '#address', test: v => !!v, msgFor: 'address' },
          { id: '#date', test: v => !!v, msgFor: 'date' },
          { id: '#time', test: v => !!v, msgFor: 'time' }
        ];

        checks.forEach(c => {
          const val = $(c.id).val();
          if (!c.test(val)) {
            $(c.id).addClass('is-invalid');
            $(`.field-error[data-for="${c.msgFor}"]`).show();
            if (ok) { // focus first invalid
              $(c.id).focus();
            }
            ok = false;
          }
        });

        return ok;
      }

      // Create booking via API (POST)
      function createBooking(payload){
        $saveBtn.prop('disabled', true).text('Saving...');
        $.ajax({
          url: API_BASE,
          method: 'POST',
          data: JSON.stringify(payload),
          contentType: 'application/json; charset=UTF-8',
          success: function(res){
            // JSONPlaceholder returns an object with an id — use that id to track locally
            const created = {
              id: res.id || Date.now(),
              ...payload
            };
            bookings.unshift(created);
            renderList($search.val());
            resetForm();
            showStatus('Booking created', 'success');
          },
          error: function(){
            showStatus('Failed to create booking (network).', 'danger');
          },
          complete: function(){ $saveBtn.prop('disabled', false).text('Save'); }
        });
      }

      // Update booking via API (PUT)
      function updateBooking(id, payload){
        $saveBtn.prop('disabled', true).text('Saving...');
        $.ajax({
          url: API_BASE + '/' + encodeURIComponent(id),
          method: 'PUT',
          data: JSON.stringify(payload),
          contentType: 'application/json; charset=UTF-8',
          success: function(){
            bookings = bookings.map(b => b.id === id ? { id: id, ...payload } : b);
            renderList($search.val());
            resetForm();
            showStatus('Booking updated', 'success');
          },
          error: function(){
            showStatus('Failed to update booking (network).', 'danger');
          },
          complete: function(){ $saveBtn.prop('disabled', false).text('Save'); }
        });
      }

      // Hook form Save behavior (Create or Update)
      $saveBtn.on('click', function(){
        if (!validateForm()) {
          showStatus('Please correct highlighted fields', 'danger');
          return;
        }

        const payload = {
          service: $('#service').val(),
          name: $('#name').val(),
          email: $('#email').val(),
          phone: $('#phone').val(),
          address: $('#address').val(),
          date: $('#date').val(),
          time: $('#time').val()
        };

        const editId = $('#editId').val();
        if (editId) {
          updateBooking(Number(editId), payload);
        } else {
          createBooking(payload);
        }
      });

      // Cancel resets the form
      $cancelBtn.on('click', function(){ resetForm(); });

      // Refresh button: load sample items from fake API (non-persistent demo)
      $refresh.on('click', function(e){
        e.preventDefault();
        $refresh.prop('disabled', true).text('Loading...');
        $.ajax({
          url: API_BASE + '?_limit=6',
          method: 'GET',
          success: function(res){
            bookings = res.map(p => {
              return {
                id: p.id,
                service: (p.title || 'Standard Home Cleaning'),
                name: 'Guest ' + p.id,
                email: 'guest' + p.id + '@example.com',
                phone: '+1 555 0000' + p.id,
                address: (p.body || '').slice(0, 40),
                date: new Date().toISOString().slice(0,10),
                time: '10:00'
              };
            });
            renderList($search.val());
            showStatus('Loaded sample bookings', 'success');
          },
          error: function(){ showStatus('Failed to load sample bookings', 'danger'); },
          complete: function(){ $refresh.prop('disabled', false).text('Refresh'); }
        });
      });

      // Search filter
      $search.on('input', function(){ renderList($(this).val()); });

      // Initialize
      $(function(){
        resetForm();
        renderList();
      });

    })(jQuery);
  </script>
</body>
</html>